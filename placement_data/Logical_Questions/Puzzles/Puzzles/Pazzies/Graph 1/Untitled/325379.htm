
<!-- RESG: 7/7/2005 4:22:52 AM - RESX: 1/1/0001 12:00:00 AM -->
<!-- (c) 2005 Microsoft Corporation. All Rights Reserved -->

<html><head><link type='text/css' rel='Stylesheet' href="d3e6e07eD.css" tppabs="http://support.microsoft.com/mnpresource/d3e6e07eD.css"><link rel='stylesheet' type='text/css' href="b433593aD.css" tppabs="http://support.microsoft.com/mnpresource/b433593aD.css"><script language='JavaScript'>var doImage=doImage;var TType=TType;function mhHover(tbl,idx,cls){var t,d;if(document.getElementById)t=document.getElementById(tbl);else t=document.all(tbl);if(t==null)return;if(t.getElementsByTagName)d=t.getElementsByTagName("TD");else d=t.all.tags("TD");if(d==null)return;if(d.length<=idx)return;d[idx].className=cls;}function setMSResearch(){var time=new Date();if(document.cookie.indexOf('msresearch=1 ')==-1){document.cookie='msresearch='+time.getTime()+':'+escape(document.location)+':'+escape(document.referrer)+'; path=/; domain=.microsoft.com; ';}}function footerjs(doc){if(doImage==null){var tt=TType==null?"PV":TType;doc.write('<layer visibility="hide"><div style="display:none"><img src="http://c.microsoft.com/trans_pixel.asp?source=localhost&TYPE=' + tt + '&p=MNPGenerator" width=0 height=0 hspace=0 vspace=0 border=0></div></layer>');}if((document.cookie.indexOf('msresearch=1 ')==-1)&&(document.cookie.indexOf('msresearch=')!=-1)){setInterval("setMSResearch()",1000);}}</script><script type="text/javascript" src="common.js-2" tppabs="http://support.microsoft.com/common/script/gsfx/common.js?2"></script><title>How to upgrade Windows 2000 domain controllers to Windows Server 2003</title><meta name="robots" content="nofollow,noarchive"><meta name="KBParents" content="5887 5886 1131 730 4064 1163 1760 7274 7940 7341 5891 7017 3198 "><meta name="Keywords" content="kbinfo KB325379"><meta name="Description" content="This article discusses how to upgrade Microsoft Windows 2000 domain controllers to Microsoft Windows Server 2003 and how to add new Windows Server 2003 domain controllers to Windows 2000 domains."><meta name="MS.LOCALE" content="en"><meta http-equiv="content-type" content="text/html; charset=utf-8"><xmlreader><link rel="stylesheet" type="text/css" href="default.css-2.css" tppabs="http://support.microsoft.com/common/css/default/default.css?2"><link rel="stylesheet" type="text/css" href="xmlContent.css-2.css" tppabs="http://support.microsoft.com/common/css/default/xmlContent.css?2"><link rel="stylesheet" type="text/css" href="override.css-2.css" tppabs="http://support.microsoft.com/common/css/default/ie/override.css?2"></xmlreader><style type="text/css">#SendFeedback_tr{display:none;}</style><script type="text/javascript">var PersonalizationInfo='a2IzMjUzNzkIZW4tdXMISG93IHRvIHVwZ3JhZGUgV2luZG93cyAyMDA_';SaveToFavoritesData.savingMsg='Saving Favorites';SaveToFavoritesData.connectionErrorMsg='Cannot Connect';SaveToFavoritesData.savedMsg='Favorites Saved';SaveToFavoritesData.noSaveErrorMsg='Cannot Save';SaveToFavoritesData.surveyUrl='\x2fcommon\x2fsurvey.aspx\x3fscid\x3dsw\x3ben\x3b1076\x26surveystyle\x3dpopup\x26showpage\x3d1\x26site\x3dgn\x26siteregion\x3den-us\x26url\x3d%2fdefault.aspx%2fkb%2f325379\x26p0\x3dkb\x26p1\x3den-us\x26p2\x3d325379';SaveToFavoritesData.noCookieUrl='\x2fgp\x2fnocookies\x2f';var gCookieDomain='';</script></head><body onload="thisLoad();" onunload="thisUnload();"><script type="text/javascript">if (self.name == "MNPMainFrame") top.location.href = self.location.href;</script><div id="msviMasthead" xmlns:Utility="http://www.microsoft.com/MSCOM/VisualIdentity/Utility"><table cellpadding="0" cellspacing="0" width="100%" border="0"><tr><td width="100%"><table cellpadding="0" cellspacing="0" width="100%" height="22" border="0"><tr><td id="msviRegionIdGraphic" bgcolor="#4B92D9"><a href="international.aspx.htm" tppabs="http://support.microsoft.com/common/international.aspx"><img src="99b166acD.gif" tppabs="http://support.microsoft.com/mnpresource/99b166acD.gif" height="22" alt="United States" title="Language Options" border="0"></a></td><td width="100%" bgcolor="#1E77D3"><img src="d80d0ecfD.gif" tppabs="http://support.microsoft.com/mnpresource/d80d0ecfD.gif" width="250" height="22" alt="*" title=""></td></tr></table></td><td id="msviGlobalToolbar" bgcolor="#1E77D3" height="22" nowrap dir="ltr" align="left"><table cellpadding="0" cellspacing="0" border="0"><tr><td class="gt0" nowrap onmouseover="mhHover('msviGlobalToolbar', 0, 'gt1')" onmouseout="mhHover('msviGlobalToolbar', 0, 'gt0')"><a href="javascript:if(confirm('http://www.microsoft.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.microsoft.com/'" tppabs="http://www.microsoft.com/">Microsoft.com Home</a></td><td class="gtsep">|</td><td class="gt0" nowrap onmouseover="mhHover('msviGlobalToolbar', 2, 'gt1')" onmouseout="mhHover('msviGlobalToolbar', 2, 'gt0')"><a href="en-us.mspx.htm" tppabs="http://support.microsoft.com/library/toolbar/3.0/sitemap/en-us.mspx">Site Map</a></td></tr></table></td></tr><tr valign="top"><td width="100%"><table cellpadding="0" cellspacing="0" width="100%" height="42" border="0" style="height: expression(parentElement.offsetHeight)"><tr valign="top"><td id="msviBrandBanner" bgcolor="0A6CCE"><a href="javascript:if(confirm('http://www.microsoft.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.microsoft.com/'" tppabs="http://www.microsoft.com/"><img src="ms_masthead_ltr.gif" tppabs="http://support.microsoft.com/library/toolbar/3.0/images/banners/ms_masthead_ltr.gif" width="136" height="42" alt="Microsoft" title="" border="0"></a></td><td width="100%" bgcolor="#FFFFFF"><img src="a0250c0dD.gif" tppabs="http://support.microsoft.com/mnpresource/a0250c0dD.gif" width="250" height="42" alt="*" title=""></td></tr></table></td><td id="msviGlobalSearch" bgcolor="#FFFFFF">Search Microsoft.com for:<br><form id="msviSearchForm" action="javascript:if(confirm('http://search.microsoft.com/search/results.aspx?st=b&na=88&View=en-us&qu=Go  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://search.microsoft.com/search/results.aspx?st=b&na=88&View=en-us&qu=Go'" tppabs="http://support.microsoft.com/library/toolbar/3.0/search.aspx?View=en-us&charset=iso-8859-1&qu=Go"><input type="hidden" name="View" value="en-us"><input type="hidden" name="charset" value="iso-8859-1"><nobr><div style="height: 18px"><input name="qu" id="msviSearchBox" maxlength="255"><input id="msviGoButton" type="submit" value="Go"></div></nobr></form></td></tr></table><table id="msviSubbanner" bgcolor="#003399" width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td><img src="4101ccf1D.gif" tppabs="http://support.microsoft.com/mnpresource/4101ccf1D.gif" width="467" height="26" alt="Help and Support" title="" border="0"></td><td width="100%">&nbsp;</td></tr></table><div id="msviLocalToolbar"><table cellpadding="0" cellspacing="0" width="100%" height="19" border="0"><tr><td nowrap id="msviHomePageLink"><a href="index.htm" tppabs="http://support.microsoft.com/">Help and Support Home</a></td><td><span class="ltsep">|</span></td><td class="lt0" nowrap onmouseover="mhHover('msviLocalToolbar', 2, 'lt1')" onmouseout="mhHover('msviLocalToolbar', 2, 'lt0')"><a href="-target=hub.htm" tppabs="http://support.microsoft.com/select/?target=hub">Select a Product</a></td><td><span class="ltsep">|</span></td><td class="lt0" nowrap onmouseover="mhHover('msviLocalToolbar', 4, 'lt1')" onmouseout="mhHover('msviLocalToolbar', 4, 'lt0')"><a href="-adv=1.htm" tppabs="http://support.microsoft.com/search/?adv=1">Search (KB)</a></td><td width="100%"></td></tr></table></div></div><table cellpadding="0" cellspacing="0" border="0" width="100%" dir="LTR"><tr valign="top">          <td width="100%" dir="LTR">        <XMLREADER><div id="contentArea"><div id="mainRow"><div class="primaryTable"><table cellpadding="0" cellspacing="0" class="primaryTable"><tr><td class="primaryMainColumn"><div id="mainColumn"><div id="kb" class="kb"><div id="default" class="default"><!-- - -KB 3 start- - --><a id="toc"></a><h1 class="title">How to upgrade Windows 2000 domain controllers to Windows Server 2003</h1><div class="appliesToLink"><a href="#appliesto">View products that this article applies to.</a></div><div class="articleProperty"><table><tr><td class="label">Article ID</td><td class="text">:</td><td class="text">325379</td></tr><tr><td class="label">Last Review</td><td class="text">:</td><td class="text">December 21, 2004</td></tr><tr><td class="label">Revision</td><td class="text">:</td><td class="text">19.3</td></tr></table></div><div class="notice">This article was previously published under Q325379</div><div class="toc"><h5>On this page</h5><table class="tallTable"><tr><td class="image"><a href="#kb1"><img src="downArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/PUBLIC/EN-US/downArrow.gif" alt="SUMMARY" title="SUMMARY"></a></td><td class="text" colspan="2"><a href="#kb1">SUMMARY</a></td></tr><tr class="subHeader"><td class="space"> </td><td class="image"><a href="#XSLTH3120120122120121120120"><img src="downArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/PUBLIC/EN-US/downArrow.gif" alt="Domain and forest inventory " title="Domain and forest inventory "></a></td><td class="text"><a href="#XSLTH3120120122120121120120">Domain and forest inventory </a></td></tr><tr class="subHeader"><td class="space"> </td><td class="image"><a href="#XSLTH3123120122120121120120"><img src="downArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/PUBLIC/EN-US/downArrow.gif" alt="Microsoft Exchange 2000 in Windows 2000 forests" title="Microsoft Exchange 2000 in Windows 2000 forests"></a></td><td class="text"><a href="#XSLTH3123120122120121120120">Microsoft Exchange 2000 in Windows 2000 forests</a></td></tr><tr class="subHeader"><td class="space"> </td><td class="image"><a href="#XSLTH3182120122120121120120"><img src="downArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/PUBLIC/EN-US/downArrow.gif" alt="Overview: Upgrading Windows 2000 domain controllers to Windows Server 2003" title="Overview: Upgrading Windows 2000 domain controllers to Windows Server 2003"></a></td><td class="text"><a href="#XSLTH3182120122120121120120">Overview: Upgrading Windows 2000 domain controllers to Windows Server 2003</a></td></tr><tr class="subHeader"><td class="space"> </td><td class="image"><a href="#XSLTH3120120123120121120120"><img src="downArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/PUBLIC/EN-US/downArrow.gif" alt="Upgrading Windows 2000 domain controllers by using Winnt32.exe" title="Upgrading Windows 2000 domain controllers by using Winnt32.exe"></a></td><td class="text"><a href="#XSLTH3120120123120121120120">Upgrading Windows 2000 domain controllers by using Winnt32.exe</a></td></tr><tr class="subHeader"><td class="space"> </td><td class="image"><a href="#XSLTH3132120123120121120120"><img src="downArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/PUBLIC/EN-US/downArrow.gif" alt="Dry-run upgrades in a lab environment" title="Dry-run upgrades in a lab environment"></a></td><td class="text"><a href="#XSLTH3132120123120121120120">Dry-run upgrades in a lab environment</a></td></tr><tr class="subHeader"><td class="space"> </td><td class="image"><a href="#XSLTH3140120123120121120120"><img src="downArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/PUBLIC/EN-US/downArrow.gif" alt="Domain controllers without sufficient disk space" title="Domain controllers without sufficient disk space"></a></td><td class="text"><a href="#XSLTH3140120123120121120120">Domain controllers without sufficient disk space</a></td></tr><tr><td class="image"><a href="#appliesto"><img src="downArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/PUBLIC/EN-US/downArrow.gif" alt="APPLIES TO" title="APPLIES TO"></a></td><td class="text" colspan="2"><a href="#appliesto">APPLIES TO</a></td></tr></table></div><div class="section"><a id="kb1"></a><h2 class="subTitle">SUMMARY</h2><div class="sbody">This article discusses how to upgrade Microsoft Windows 2000 domain controllers to Microsoft Windows Server 2003 and how to add new Windows Server 2003 domain controllers to Windows 2000 domains.<div class="topOfPage"><table><tr><td class="image"><a href="#toc"><img src="upArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/public/en-us/upArrow.gif" alt="Back to the top" title="Back to the top"></a></td><td class="text"><a href="#toc">Back to the top</a></td></tr></table></div></div><div class="sbody"><a id="XSLTH3120120122120121120120"></a><h3>Domain and forest inventory </h3>Before you upgrade Windows 2000 domain controllers to Windows Server 2003 or before you add new Windows Server 2003 domain controllers to a Windows 2000 domain, follow these steps:<table class="list"><tr><td class="number">1.</td><td class="text">Inventory the clients that access resources in the domain that host Windows Server 2003 domain controllers for compatibility with SMB signing:  <br><br>Each Windows Server 2003 domain controller enables SMB signing in its local security policy. Make sure that all network clients that use the SMB/CIFS protocol to access shared files and printers in domains that host Windows Server 2003 domain controllers can be configured or upgraded to support SMB signing. If they cannot, temporarily disable SMB signing until updates can be installed or until the clients can be upgraded to newer operating systems that support SMB signing. For information about how to disable SMB signing, see the "<span><a href="#1">To disable SMB signing</a></span>" section at the end of this step.<br><br><b>Action plans</b><br><br>The following list shows the action plans for popular SMB clients:<table class="list"><tr><td class="bullet">•</td><td class="text"><b>Microsoft Windows Server 2003, Microsoft Windows XP Professional, Microsoft Windows 2000 Server, Microsoft Windows 2000 Professional, and Microsoft Windows 98</b><br><br>No action is required.</td></tr><tr><td class="bullet">•</td><td class="text"><b>Microsoft Windows NT 4.0</b><br><br> Install Service Pack 3 or later (Service Pack 6A is recommended) on all Windows NT 4.0-based computers that access domains that contain Windows Server 2003-based computers. Alternatively, temporarily disable SMB signing on Windows Server 2003 domain controllers. For information about how to disable SMB signing, see the "<span><a href="#1">To disable SMB signing</a></span>" section at the end of this step.<br></td></tr><tr><td class="bullet">•</td><td class="text"><b>Microsoft Windows 95</b><br><br> Install the Windows 9<i>x</i> directory service client on the Windows 95-based computers or temporarily disable SMB signing on Windows Server 2003 domain controllers. The original Win9<i>x</i> directory service client is available on the Windows 2000 Server CD-ROM. However, that client add-on has been replaced by an improved Win9<i>x</i> directory service client. For information about how to disable SMB signing, see the "<span><a href="#1">To disable SMB signing</a></span>" section at the end of this step.<br><br>

For additional information, click the following article number to view the article in the Microsoft Knowledge Base:

<div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/323466/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/323466/'" tppabs="http://support.microsoft.com/kb/323466/">323466</a></span>

 Availability of the Active Directory client extension update for Windows 98

</div></td></tr><tr><td class="bullet">•</td><td class="text"><b>Microsoft Network Client for MS-DOS and Microsoft LAN Manager clients</b><br><br>The Microsoft Network Client for MS-DOS and the Microsoft LAN Manager 2.x network client may be used to provide access to network resources, or they may be combined with a bootable floppy disk to copy operating system files and other files from a shared directory on a file server as part of a software installation routine. These clients do not support SMB signing. Use an alternative installation method, or disable SMB signing. For information about how to disable SMB signing, see the "<span><a href="#1">To disable SMB signing</a></span>" section at the end of this step.</td></tr><tr><td class="bullet">•</td><td class="text"><b>Macintosh clients</b><br><br>Some Macintosh clients are not SMB signing compatible and will receive the following error message when they try to connect to a network resource: <div class="errormsg">- Error -36 I/O</div>Install updated software if it is available. Otherwise, disable SMB signing on Windows Server 2003 domain controllers. For information about how to disable SMB signing, see the "<span><a href="#1">To disable SMB signing</a></span>" section at the end of this step.</td></tr><tr><td class="bullet">•</td><td class="text"><b>Other third-party SMB clients</b><br><br>Some third-party SMB clients do not support SMB signing. Consult your SMB provider to see if an updated version exists. Otherwise, disable SMB signing on Windows Server 2003 domain controllers.</td></tr></table><b><span><a id="1"></a></span>To disable SMB signing</b><br><br>If  software updates cannot be installed on affected domain controllers that are running Windows 95,  Windows NT 4.0, or other clients that were installed before the introduction of Windows Server 2003, temporarily disable the SMB service signing requirements in Group Policy until you can deploy updated client software.<br><br>You can disable SMB service signing in the following node of Default Domain Controllers policy on the domain controllers organizational unit:<div class="indent">
Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options\Microsoft Network Server: Digitally sign communications (always)</div>If domain controllers are not located in the domain controller's organizational unit, you must link the default domain controller's Group Policy object (GPO) to all organizational units that host Windows 2000 or Windows Server 2003 domain controllers. Or, you can configure SMB service signing in a GPO that is linked to those organizational units.</td></tr><tr><td class="number">2.</td><td class="text">Inventory the domain controllers that are in the domain and in the forest:  <table class="list"><tr><td class="number">a. </td><td class="text">Make sure that all the Windows 2000 domain controllers in the forest have installed all the appropriate hotfixes and service packs.<br><br>Microsoft recommends that all the Windows 2000 domain controllers run the Windows 2000 Service Pack 4 (SP4) or later operating systems. If you cannot fully deploy Windows 2000 SP4 or later, all the Windows 2000 domain controllers <i>must</i> have an Ntdsa.dll file whose date stamp and version is later than June 4th, 2001 and 5.0.2195.3673.

For additional information, click the following article number to view the article in the Microsoft Knowledge Base:

<div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/331161/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/331161/'" tppabs="http://support.microsoft.com/kb/331161/">331161</a></span>

 Hotfixes to install on Windows 2000 domain controllers before running Adprep /Forestprep

</div>By default, Active Directory administrative tools on Windows 2000 SP4, Windows XP, and Windows Server 2003 client computers use Lightweight Directory Access Protocol (LDAP) signing. If such computers use (or fall back to) NTLM authentication when they remotely administer  Windows 2000 domain controllers, the connection will not work. To resolve this behavior, remotely administered  domain controllers should have a minimum of Windows 2000 SP3 installed. Otherwise you should turn off LDAP signing on the clients that run the administration tools.

For additional information about LDAP, click the following article numbers to view the articles in the Microsoft Knowledge Base:

<div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/325465/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/325465/'" tppabs="http://support.microsoft.com/kb/325465/">325465</a></span>

 Windows 2000 domain controllers require S325465 or later when using Windows Server 2003 administration tools

</div>The following scenarios use NTLM authentication:  <table class="list"><tr><td class="bullet">•</td><td class="text">You administer Windows 2000 domain controllers that   are located in an external forest connected by an NTLM (non-Kerberos)   trust.</td></tr><tr><td class="bullet">•</td><td class="text">You focus Microsoft Management Console (MMC) snap-ins against a specific domain   controller that is referenced by its IP address. For example, you click   <strong class="uiterm">Start</strong>, click <strong class="uiterm">Run</strong>, and then type the following command:<div class="indent"><span class="userInput">dsa.msc /server=ipaddress</span></div></td></tr></table>To determine the operating system and the service pack revision level of Active Directory domain controllers in an Active Directory domain, install the Windows Server 2003 version of Repadmin.exe on a Windows XP Professional or Windows Server 2003 member computer in the forest, and then run the following <b>repadmin</b> command against a domain controller in each domain in the forest:<div class="indent"><span class="userInput">&gt;repadmin /showattr <var>name of the domain controller that is in the target domain</var> ncobj:domain: /filter:"(&amp;(objectCategory=computer)(primaryGroupID=516))"
/subtree /atts:operatingSystem,operatingSystemVersion,operatingSystemServicePack</span><br><br><span class="userInput">DN: CN=NA-DC-01,organizational unit=Domain Controllers,DC=company,DC=com</span><br><span class="userInput">1&gt; operatingSystem: Windows Server 2003</span><br><span class="userInput">1&gt; operatingSystemVersion: 5.2 (3718)<br>
DN: CN=NA-DC-02,organizational unit=Domain Controllers,DC=company,DC=com</span><br><span class="userInput">1&gt; operatingSystem: Windows 2000 Server</span><br><span class="userInput">1&gt; operatingSystemVersion: 5.0 (2195)</span><br><span class="userInput">1&gt; operatingSystemServicePack: Service Pack 1</span></div><b>Note</b>: The domain controller's attributes do not track the installation of individual hotfixes.</td></tr><tr><td class="number">b. </td><td class="text">Verify the end-to-end Active Directory replication throughout the forest.<br><br>Verify that each domain controller in the upgraded forest replicates all its locally held naming contexts with its partners consistently with the schedule that site links or connection objects define. Use the Windows Server 2003 version of Repadmin.exe on a Windows XP- or Windows Server 2003-based member computer in the forest with the following arguments:<code><pre class="code">
REPADMIN /REPLSUM /BYSRC /BYDEST /SORT:DELTA              &lt;-output formatted to fit on page

DestDC    largest delta    fails/total  %%  error

NA-DC-01 13d.21h:10m:10s    97 / 143  67  (8240) There is no such object...
NA-DC-02 13d.04h:11m:07s   180 / 763  23  (8524) The DSA operation...
NA-DC-03 12d.03h:54m:41s     5 /   5 100  (8524) The DSA operation...</pre></code> All the domain controllers in the forest must replicate Active Directory without error, and the values in the "Largest Delta" column of the repadmin output should not be significantly greater than the replication frequency on the corresponding site links or connection objects that are used by a given destination domain controller. <br><br>Resolve all replication errors between domain controllers that have failed to inbound replicate in less than Tombstone Lifetime (TSL) number of days (by default, 60 days). If replication cannot be made to function, you may have to forcibly demote the domain controllers and remove them from the forest by using the Ntdsutil <b>metadata cleanup</b> command, and then promote them back into the forest. You can use a forceful demotion to save both the operating system installation and the programs that are on an orphaned domain controller.

For additional information about how to remove orphaned Windows 2000 domain controllers from their domain, click the following article number to view the article in the Microsoft Knowledge Base:

<div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/216498/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/216498/'" tppabs="http://support.microsoft.com/kb/216498/">216498</a></span>

 HOW TO: Remove data in Active Directory after an unsuccessful domain controller demotion

</div>Take this action only as a last resort to recover the installation of the operating system and the installed programs. You will lose unreplicated objects and attributes on orphaned domain controllers including users, computers, trust relationships, their passwords, groups and group memberships.<br><br>Be careful when you try to resolve replication errors on domain controllers that have not replicated inbound changes for a particular Active Directory partition for greater than <var>tombstonelifetime</var> number of days. When you do so, you may reanimate objects that were deleted on one domain controller but for which direct or  transitive replication partners never received the deletion in the previous 60 days. <br><br>Consider removing any lingering objects that reside on domain controllers that have not performed inbound replication in the last 60 days. Alternatively, you can forcefully demote domain controllers that have not performed any inbound replication on a given partition in tombstone lifetime number of days and remove their remaining metadata from the Active Directory forest by using Ntdsutil and other utilities. Contact your support provider or Microsoft PSS for additional help.</td></tr><tr><td class="number">c. </td><td class="text">Verify that the contents of the Sysvol share are consistent.<br><br>Verify that the file system portion of group policy is consistent. You can use Gpotool.exe from the Resource Kit to determine whether there are inconsistencies in policies across a domain. Use Healthcheck from the Windows Server 2003 support tools to determine whether the Sysvol share replica sets function correctly in each domain.<br><br> If the contents of the Sysvol share are inconsistent, resolve all the inconsistencies. </td></tr><tr><td class="number">d. </td><td class="text">Use Dcdiag.exe from the support tools to verify that all the domain controllers have shared Netlogon and Sysvol shares. To do so, type the following command at a command prompt: <div class="indent"><span class="userInput">DCDIAG.EXE /e /test:frssysvol</span></div></td></tr><tr><td class="number">e. </td><td class="text">Inventory the operations roles.<br><br>The schema and infrastructure operations masters are used to introduce forest and domain-wide schema changes to the forest and its domains that are made by the Windows Server 2003 <b>adprep</b> utility. Verify that the domain controller that hosts the schema role and infrastructure role for each domain in the forest reside on live domain controllers and that each role owner has performed inbound replication over all partitions since  they were last restarted. <br><br>The <b>DCDIAG /test:FSMOCHECK</b> command can be used to view forest-wide and domain-wide operational roles. Operations master roles that reside on non-existent domain controllers should be seized to a healthy domain controller by using NTDSUTIL. Roles that reside on unhealthy domain controllers should be transferred if possible. Otherwise, they should be seized. The <b>NETDOM QUERY FSMO</b> command does not identify FSMO roles that reside on deleted domain controllers.<br><br>Verify that the schema master and each infrastructure master has performed inbound replication of Active Directory since last booted. Inbound replication can be verified by using the <b>REPADMIN  /SHOWREPS <var>DCNAME</var></b> command, where <var>DCNAME</var> is the NetBIOS computer name or the fully qualified computer name of a domain controller.<br><br>

For additional information about operations masters and their placement, click the following article numbers to view the articles in the Microsoft Knowledge Base:

<div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/197132/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/197132/'" tppabs="http://support.microsoft.com/kb/197132/">197132</a></span>

 Windows 2000 Active Directory FSMO roles

</div><div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/223346/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/223346/'" tppabs="http://support.microsoft.com/kb/223346/">223346</a></span> FSMO placement and optimization on Windows 2000 domain controllers

</div></td></tr><tr><td class="number">f. </td><td class="text">EventLog Review<br><br> Examine the event logs on all the domain controllers for problematic events. The event logs must not contain serious event messages that indicate a problem with any of the following processes and components:<div class="indent">physical connectivity<br>network connectivity<br>name registration<br>name resolution<br>authentication<br>Group Policy<br>security policy<br>disk subsystem<br>schema<br>topology<br>replication engine</div></td></tr><tr><td class="number">g. </td><td class="text">Disk Space Inventory<br><br>The volume that hosts the Active Directory database file, Ntds.dit, must have free space equal to at least 15-20% of the Ntds.dit file size. The volume that hosts the Active Directory log file must also have free space equal to at least 15-20% of the Ntds.dit file size. For additional information about how to free up additional disk space, see the "Domain Controllers Without Sufficient Disk Space" section of this article.</td></tr><tr><td class="number">h. </td><td class="text">DNS Scavenging (Optional)<br><br>Enable DNS Scavenging at 7-day intervals for all DNS servers in the forest. For best results, perform this operation 61 or more days before you upgrade the operating system. This provides the DNS scavenging daemon sufficient time to garbage-collect the aged DNS objects when an offline defragmentation is performed on the Ntds.dit file.</td></tr><tr><td class="number">i. </td><td class="text">Disable the DLT Server Service (Optional)<br><br>The DLT Server service is disabled on new and upgraded installations of Windows Server 2003 domain controllers. If distributed link tracking is not used, you can disable the DLT Server service on your Windows 2000 domain controllers and begin deleting DLT objects from each domain in the forest. For additional information, see the "Microsoft Recommendations for distributed link tracking" section of the following article in the Microsoft Knowledge Base:<div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/312403/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/312403/'" tppabs="http://support.microsoft.com/kb/312403/">312403</a></span> Distributed link tracking on Windows-based domain controllers

</div></td></tr><tr><td class="number">j. </td><td class="text">System State Backup<br><br> Make a system state backup of at least two domain controllers in every domain in the forest. You can use the backup to recover all the domains in the forest if the upgrade does not work.</td></tr></table></td></tr></table><a id="XSLTH3123120122120121120120"></a><h3>Microsoft Exchange 2000 in Windows 2000 forests</h3><b>Notes</b><table class="list"><tr><td class="bullet">•</td><td class="text">If Exchange 2000 Server is installed, or will be installed, in a Windows 2000 forest, read this section before you run the Windows Server 2003 <b>adprep /forestprep</b> command.</td></tr><tr><td class="bullet">•</td><td class="text">If Microsoft Exchange Server 2003 schema changes will be installed, go to the "<span><a href="#2">Overview: Upgrading Windows 2000 domain controllers to Windows Server 2003</a></span>" section before you run the Windows Server 2003 <b>adprep</b> commands.</td></tr></table>The Exchange 2000 schema defines three <b>inetOrgPerson</b> attributes with non-Request for Comment (RFC)-compliant LDAPDisplayNames: <b>houseIdentifier</b>, <b>secretary</b>, and <b>labeledURI</b>.<br><br> The Windows 2000 inetOrgPerson Kit and the Windows Server 2003 <b>adprep</b> command define RFC-complaint versions of the same three attributes with identical LDAPDisplayNames as the RFC-compliant versions. <br><br>When the Windows Server 2003 <b>adprep /forestprep</b> command is run without corrective scripts in a forest that contains Windows 2000 and Exchange 2000 schema changes, the LDAPDisplayNames for the <b>houseIdentifier</b>, <b>labeledURI</b>, and <b>secretary</b> attributes become mangled. An attribute becomes “mangled” if "Dup" or other unique characters are added to the beginning of the conflicted attribute name so that objects and attributes in the directory have unique names.<br><br>Active Directory forests are not vulnerable to mangled LDAPDisplayNames for these attributes in the following cases:  <table class="list"><tr><td class="bullet">•</td><td class="text">If you run the Windows Server 2003 <b>adprep /forestprep</b> command in a forest that contains the Windows 2000 schema before you add the Exchange 2000 schema.</td></tr><tr><td class="bullet">•</td><td class="text">If you install the Exchange 2000 schema in forest that was created where a Windows Server 2003 domain controller was the first domain controller in the forest.</td></tr><tr><td class="bullet">•</td><td class="text">If you add Windows 2000 inetOrgPerson Kit to a forest that contains the Windows 2000 schema,  and then you install  Exchange 2000 schema changes,  and then you run the Windows Server 2003 <b>adprep /forestprep</b> command.</td></tr></table>Mangled attributes will occur in Windows 2000 in the following cases:<table class="list"><tr><td class="bullet">•</td><td class="text">If you add the Exchange 2000 versions of the <b>labeledURI</b>, the <b>houseIdentifier</b>, and the <b>secretary</b> attributes to a Windows 2000 forest before you install the Windows 2000 inetOrgPerson Kit. </td></tr><tr><td class="bullet">•</td><td class="text">	You add the Exchange 2000 versions of the <b>labeledURI</b>, the <b>houseIdentifier</b>, and the <b>secretary</b> attributes to a Windows 2000 forest before you run the Windows Server 2003 <b>adprep /forestprep</b> command without first running the cleanup scripts.</td></tr></table>Action  plans for each scenario follow: <a id="XSLTH4158120122120121120120"></a><h4>Scenario 1: Exchange 2000 schema changes are added after you run the Windows Server 2003 adprep /forestprep command</h4>If Exchange 2000 schema changes will be introduced to your Windows 2000 forest after the Windows Server 2003 <b>adprep /forestprep</b> command is run, no cleanup is required. Go to the "<span><a href="#2">Overview: Upgrading Windows 2000 domain controllers to Windows Server 2003</a></span>" section.<a id="XSLTH4164120122120121120120"></a><h4>Scenario 2: Exchange 2000 schema changes will be installed before the Windows Server 2003 adprep /forestprep command</h4>If Exchange 2000 schema changes have already been installed but you have NOT run the Windows Server 2003 <b>adprep /forestprep</b> command, consider the following action plan:  <table class="list"><tr><td class="number">1.</td><td class="text">Log on to the console of the schema operations master by using an account that is a member of the Schema Admins security group.</td></tr><tr><td class="number">2.</td><td class="text">Click <strong class="uiterm">Start</strong>, click <strong class="uiterm">Run</strong>, type <span class="userInput">notepad.exe</span> in the <strong class="uiterm">Open</strong> box, and then click <strong class="uiterm">OK</strong>. </td></tr><tr><td class="number">3.</td><td class="text">Copy the following text including the trailing hyphen after "schemaUpdateNow: 1" to Notepad.<div class="indent">dn: CN=ms-Exch-Assistant-Name,CN=Schema,CN=Configuration,DC=X<br>changetype: Modify<br>replace:LDAPDisplayName<br>LDAPDisplayName: msExchAssistantName<br>-<br><br>dn: CN=ms-Exch-LabeledURI,CN=Schema,CN=Configuration,DC=X<br>changetype: Modify<br>replace: LDAPDisplayName<br>LDAPDisplayName: msExchLabeledURI<br>-<br><br>dn: CN=ms-Exch-House-Identifier,CN=Schema,CN=Configuration,DC=X<br>changetype: Modify<br>replace: LDAPDisplayName<br>LDAPDisplayName: msExchHouseIdentifier<br>-<br><br>dn: <br>changetype: Modify<br>add: schemaUpdateNow<br>schemaUpdateNow: 1<br>-<br></div></td></tr><tr><td class="number">4.</td><td class="text">On the <strong class="uiterm">File</strong> menu, click <strong class="uiterm">Save</strong>. In the <strong class="uiterm">Save As</strong> dialog box, follow these steps:<table class="list"><tr><td class="number">a. </td><td class="text">In the <strong class="uiterm">File name</strong> box, type the following:<div class="indent"><span class="userInput">\%userprofile%\InetOrgPersonPrevent.ldf</span></div></td></tr><tr><td class="number">b. </td><td class="text">In the <strong class="uiterm">Save as type</strong> box, click <strong class="uiterm">All Files</strong>.</td></tr><tr><td class="number">c. </td><td class="text">In the <strong class="uiterm">Encoding</strong> box, click <strong class="uiterm">Unicode</strong>.</td></tr><tr><td class="number">d. </td><td class="text">Click <strong class="uiterm">Save</strong>. </td></tr><tr><td class="number">e. </td><td class="text">Quit Notepad.</td></tr></table></td></tr><tr><td class="number">5.</td><td class="text">Run the InetOrgPersonPrevent.ldf script.  <table class="list"><tr><td class="number">a. </td><td class="text">Click <strong class="uiterm">Start</strong>, click <strong class="uiterm">Run</strong>, type <span class="userInput">cmd</span> in the <strong class="uiterm">Open</strong> box, and then click <strong class="uiterm">OK</strong>. </td></tr><tr><td class="number">b. </td><td class="text">At a command prompt, type the following, and then press ENTER:<div class="indent"><span class="userInput">cd   <var>%userprofile%</var></span></div></td></tr><tr><td class="number">c. </td><td class="text">Type the following command<div class="indent"><span class="userInput">c:\documents and settings\%username%&gt;ldifde -i -f inetorgpersonprevent.ldf -v -c DC=X "<var>domain name path for forest root domain</var>"</span></div>Syntax notes: <table class="list"><tr><td class="bullet">•</td><td class="text">DC=X is a case-sensitive constant.</td></tr><tr><td class="bullet">•</td><td class="text">The domain name path for the root domain must be enclosed in quotation marks.</td></tr></table>For example, the command syntax for an Active Directory forest whose forest root domain is TAILSPINTOYS&gt;COM would be:<div class="indent"><span class="userInput">c:\documents and settings\administrator&gt;ldifde -i -f inetorgpersonprevent.ldf -v -c DC=X "dc=tailspintoys,dc=com"</span></div></td></tr></table></td></tr><tr><td class="number">6.</td><td class="text">Verify that the LDAPDisplayNames for the CN=ms-Exch-Assistant-Name, CN=ms-Exch-LabeledURI, and CN=ms-Exch-House-Identifier attributes in the schema naming context now appear as msExchAssistantName, msExchLabeledURI, and msExchHouseIdentifier before you run the Windows Server 2003 <b>adprep /forestprep</b> commands.</td></tr><tr><td class="number">7.</td><td class="text">Go to the "<span><a href="#2">Overview: Upgrading Windows 2000 domain controllers to Windows Server 2003</a></span> " section to run the <b>adprep /forestprep</b> and <b>/domainprep</b> commands.</td></tr></table><a id="XSLTH4169120122120121120120"></a><h4>Scenario 3: The Windows Server 2003 forestprep command was run without first running inetOrgPersonFix</h4>If you run the Windows Server 2003 <b>adprep /forestprep</b> command in a Windows 2000 forest that contains the Exchange 2000 schema changes, the LDAPDisplayName attributes for <b>houseIdentifier</b>, <b>secretary</b>, and <b>labeledURI</b> will become mangled. To identify mangled names, use Ldp.exe to locate the affected attributes:  <table class="list"><tr><td class="number">1.</td><td class="text">Install Ldp.exe from the Support\Tools folder of the Microsoft Windows 2000 or Windows Server 2003 media.</td></tr><tr><td class="number">2.</td><td class="text">Start Ldp.exe from a domain controller or member computer in the forest.  <table class="list"><tr><td class="number">a. </td><td class="text">On the <strong class="uiterm">Connection</strong> menu, click <strong class="uiterm">Connect</strong>, leave the <strong class="uiterm">Server</strong> box empty, type <span class="userInput">389</span> in the <strong class="uiterm">Port</strong> box, and then click <strong class="uiterm">OK</strong>.</td></tr><tr><td class="number">b. </td><td class="text">On the <strong class="uiterm">Connection</strong> menu, click <strong class="uiterm">Bind</strong>, leave all the boxes empty, and then click <strong class="uiterm">OK</strong>.</td></tr></table></td></tr><tr><td class="number">3.</td><td class="text">Record the distinguished name path for the SchemaNamingContext attribute. For example, for a domain controller in the CORP.ADATUM.COM forest, the distinguished name path might be CN=Schema,CN=Configuration,DC=corp,DC=company,DC=com.</td></tr><tr><td class="number">4.</td><td class="text">On the <strong class="uiterm">Browse</strong> menu, click <strong class="uiterm">Search</strong>.</td></tr><tr><td class="number">5.</td><td class="text">Use the following settings to configure the <strong class="uiterm">Search</strong> dialog box:  <table class="list"><tr><td class="bullet">•</td><td class="text"><strong class="uiterm">Base DN</strong>: The distinguished name path for the schema naming context that is identified in step 3.</td></tr><tr><td class="bullet">•</td><td class="text"><strong class="uiterm">Filter</strong>: (ldapdisplayname=dup*) </td></tr><tr><td class="bullet">•</td><td class="text"><strong class="uiterm">Scope</strong>: Subtree</td></tr></table></td></tr><tr><td class="number">6.</td><td class="text">Mangled <b>houseIdentifier</b>, <b>secretary</b>, and <b>labeledURI</b> attributes have LDAPDisplayName attributes that are
similar to the following format: <div class="indent">LDAPDisplayName: DUP-labeledURI-9591bbd3-d2a6-4669-afda-48af7c35507d;<br>LDAPDisplayName: DUP-secretary-c5a1240d-70c0-455c-9906-a4070602f85f<br>LDAPDisplayName: DUP-houseIdentifier-354b0ca8-9b6c-4722-aae7-e66906cc9eef</div></td></tr><tr><td class="number">7.</td><td class="text">If the LDAPDisplayNames for <b>labeledURI</b>, <b>secretary</b>, and <b>houseIdentifier</b> were mangled in step 6, run the Windows Server 2003 InetOrgPersonFix.ldf script to recover, and then go to the "<span><a href="#3">Upgrading Windows 2000 domain controllers with Winnt32.exe</a></span>" section.  <table class="list"><tr><td class="number">a. </td><td class="text"> Create a folder named %Systemdrive%\IOP, and then extract the InetOrgPersonFix.ldf file to this folder. </td></tr><tr><td class="number">b. </td><td class="text">At a command prompt, type <span class="userInput">cd %systemdrive%\iop</span>.</td></tr><tr><td class="number">c. </td><td class="text">Extract the InetOrgPersonFix.ldf file from the Support.cab file that is located in the Support\Tools folder of the Windows Server 2003 installation media.</td></tr><tr><td class="number">d. </td><td class="text"> From the console of the schema operations master, load the InetOrgPersonFix.ldf file by using Ldifde.exe to correct the <b>LdapDisplayName</b> attribute of the <b>houseIdentifier</b>, <b>secretary</b>, and <b>labeledURI</b> attributes. To do so, type the following command, where &lt;X&gt; is a case-sensitive constant and &lt;dn path for forest root domain&gt; is the domain name path for the root domain of the forest: <div class="indent"><span class="userInput">C:\IOP&gt;ldifde -i -f inetorgpersonfix.ldf -v -c DC=X "<var>domain name path for forest root domain</var>"</span></div>Syntax notes:<table class="list"><tr><td class="bullet">•</td><td class="text">DC=X is a case-sensitive constant.</td></tr><tr><td class="bullet">•</td><td class="text">The domain name path for the forest root domain must be enclosed in quotation marks.</td></tr></table></td></tr></table></td></tr><tr><td class="number">8.</td><td class="text">Verify that the <b>houseIdentifier</b>, <b>secretary</b>, and <b>labeledURI</b> attributes in the schema naming context are not "mangled" before you install Exchange 2000.</td></tr></table>

For additional information about a related schema conflict with Services for UNIX version 2.0, click the following article number to view the article in the Microsoft Knowledge Base:

<div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/293783/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/293783/'" tppabs="http://support.microsoft.com/kb/293783/">293783</a></span>

 Cannot upgrade Windows 2000 server to Windows Server 2003 with Windows Services for UNIX 2.0 installed

</div><a id="XSLTH3182120122120121120120"></a><h3><span><a id="2"></a></span>Overview: Upgrading Windows 2000 domain controllers to Windows Server 2003</h3> The Windows Server 2003 <b>adprep</b> command that you run from the \I386 folder of the Windows Server 2003 media prepares a Windows 2000 forest and its domains for the addition of Windows Server 2003 domain controllers. The Windows Server 2003 <b>adprep /forestprep</b> command adds the following features:  <table class="list"><tr><td class="bullet">•</td><td class="text">Improved default security descriptors for object classes
</td></tr><tr><td class="bullet">•</td><td class="text">New user and group attributes </td></tr><tr><td class="bullet">•</td><td class="text">New Schema objects and attributes like inetOrgPerson</td></tr></table>The <b>adprep </b> utility supports two command-line arguments:<div class="indent"><b>adprep /forestprep</b>: Runs forest upgrade operations.<br><b>adprep /domainprep</b>: Runs domain upgrade operations. </div> The <b>adprep /forestprep</b> command is a one-time operation performed on the schema operation master (FSMO) of the forest. The <b>forestprep</b> operation must complete and replicate to the infrastructure master of each domain before you can run <b>adprep /domainprep</b> in that domain. <br><br>The <b>adprep /domainprep</b> command is a one-time operation that you run on the infrastructure operations master domain controller of each domain in the forest that will host new or upgraded Windows Server 2003 domain controllers. The <b>adprep /domainprep</b> command verifies that the changes from <b>forestprep</b> have replicated in the domain partition and then makes its own changes to the domain partition and group policies in the Sysvol share.<br><br>You cannot perform either of the following actions unless the <b>/forestprep</b> and the <b>/domainprep</b> operations have completed and replicated to all the domain controllers in that domain:  <table class="list"><tr><td class="bullet">•</td><td class="text">Upgrade the Windows 2000 domain controllers to Windows Server 2003 domain controllers by using Winnt32.exe.<br><br><b>Note</b>: You can upgrade the Windows 2000 member servers and computers to Windows Server 2003 member computers whenever you want.</td></tr><tr><td class="bullet">•</td><td class="text">Promote new Windows Server 2003 domain controllers into the domain by using Dcpromo.exe. </td></tr></table>The domain that hosts the schema operations master is the only domain where you must run both <b>adprep /forestprep</b> and <b>adprep /domainprep</b>. In all other domains, you only have to run <b>adprep /domainprep</b>. <br><br>The <b>adprep /forestprep</b> and the <b>adprep /domainprep</b> commands do not add attributes to the global catalog partial attribute set or cause a full synchronization of the global catalog. The RTM version of <b>adprep /domainprep</b> does cause a full sync of the \Policies folder in the Sysvol tree. Even if you run <b>forestprep</b> and <b>domainprep</b> several times, completed operations are performed only one time. <br><br>After the changes from <b>adprep /forestprep</b> and <b>adprep /domainprep</b> completely replicate, you can upgrade the Windows 2000 domain controllers to Windows Server 2003 by running Winnt32.exe from the \I386 folder of the Windows Server 2003 media. Also, you can add new Windows Server 2003 domain controllers to the domain by using Dcpromo.exe.<a id="XSLTH4244120122120121120120"></a><h4>Upgrading the forest with the adprep /forestprep command</h4>To prepare a Windows 2000 forest and domains to accept Windows Server 2003 domain controllers, follow these steps first in a lab environment, then in a production environment:  <table class="list"><tr><td class="number">1.</td><td class="text">Make sure that you have completed all the operations in the "Forest Inventory" phase with special attention to the following items:  <table class="list"><tr><td class="number">a. </td><td class="text">You have created system state backups.</td></tr><tr><td class="number">b. </td><td class="text">All the Windows 2000 domain controllers in the forest have installed all the appropriate hotfixes and service packs.</td></tr><tr><td class="number">c. </td><td class="text">End-to-end replication of Active Directory is occurring throughout the forest</td></tr><tr><td class="number">d. </td><td class="text">FRS replicates the file system policy correctly throughout each domain.</td></tr></table></td></tr><tr><td class="number">2.</td><td class="text">Log on to the console of the schema operations master with an account that is a member of the Schema Admins security group.</td></tr><tr><td class="number">3.</td><td class="text">Verify that the schema FSMO has performed inbound replication of the schema partition by typing the following at a Windows NT command prompt:<div class="indent"><span class="userInput">repadmin /showreps</span></div> (<b>repadmin</b> is installed by the Support\Tools folder of Active Directory.)  </td></tr><tr><td class="number">4.</td><td class="text">Early Microsoft documentation recommends that you isolate the schema operations master on a private network before you run <b>adprep /forestprep</b>. Real-world experience suggests that this step is not necessary and may cause a schema operations master to reject schema changes when it is restarted on a private network. If you want to isolate schema additions that were made by <b>adprep</b>, Microsoft recommends that you temporarily disable outbound replication of Active Directory with the <b>repadmin</b> command-line utility. To do this, following these steps:<table class="list"><tr><td class="number">a. </td><td class="text">Click <strong class="uiterm">Start</strong>, click <strong class="uiterm">Run</strong>, type <span class="userInput">cmd</span>, and then click <strong class="uiterm">OK</strong>.</td></tr><tr><td class="number">b. </td><td class="text">Type the following, and then press ENTER: <div class="indent"><span class="userInput">repadmin /options  +DISABLE_OUTBOUND_REPL</span></div></td></tr></table></td></tr><tr><td class="number">5.</td><td class="text">Run <b>adprep</b> on the schema operations master. To do so, click <strong class="uiterm">Start</strong>, click <strong class="uiterm">Run</strong>, type <span class="userInput">cmd</span>, and then click <strong class="uiterm">OK</strong>. On the schema operations master, type the following command<div class="indent"><span class="userInput"><var>X:\I386\</var>adprep /forestprep</span></div> where <var>X:\I386\</var> is the path of the Windows Server 2003 installation media. This command runs the forest-wide schema upgrade.<br><br><b>Note</b> Events with event ID 1153 that are logged in the Directory Service event log, such as the sample that follows, can be ignored:<p class="indent">Event Type : Error <br>Event Source : NTDS General <br>Event Category: Internal Processing<br> Event ID : 1153 <br>Date: MM/DD/YYYY <br>Time: HH:MM:SS AM|PM<br> User : Everyone Computer : &lt;some DC&gt;<br> Description: Class identifier 655562 (class name msWMI-MergeablePolicyTemplate) has an invalid superclass 655560. Inheritance ignored. </p></td></tr><tr><td class="number">6.</td><td class="text">Verify that the <b>adprep /forestprep</b> command successfully ran on the schema operations master. To do so, from the console of the schema operations master, verify the following items:  <table class="list"><tr><td class="bullet">•</td><td class="text">The <b>adprep /forestprep</b> command completed without error. </td></tr><tr><td class="bullet">•</td><td class="text">The CN=Windows2003Update object is written under CN=ForestUpdates,CN=Configuration,DC=<var>forest_root_domain</var>. Record the value of the Revision attribute.</td></tr><tr><td class="bullet">•</td><td class="text">(Optional) The schema version incremented to version 30. To do so, see the ObjectVersion attribute under CN=Schema,CN=Configuration,DC=<var>forest_root_domain</var>.</td></tr></table>If <b>adprep /forestprep</b> does not run, verify the following items:  <table class="list"><tr><td class="bullet">•</td><td class="text">The fully qualified path for Adprep.exe located in the \I386 folder of the installation media was specified when <b>adprep</b> ran. To do so, type the following command: <div class="indent"><span class="userInput"><var>x</var>:\i386\adprep /forestprep</span></div> where <var>x</var> is the drive that hosts the installation media.</td></tr><tr><td class="bullet">•</td><td class="text">The logged on user who runs <b>adprep</b> has membership to the Schema Admins security group. To verify this, use the <b>whoami /all</b> command.</td></tr><tr><td class="bullet">•</td><td class="text">If <b>adprep</b> still does not work, view the Adprep.log file in the %systemroot%\System32\Debug\Adprep\Logs\<var>Latest_log</var> folder.</td></tr></table></td></tr><tr><td class="number">7.</td><td class="text">If you disabled outbound replication on the schema operations master in step 4, enable replication so that the schema changes that were made by <b>adprep /forestprep</b> can propagate. To do this, following these steps:<table class="list"><tr><td class="number">a. </td><td class="text">Click <strong class="uiterm">Start</strong>, click <strong class="uiterm">Run</strong>, type <span class="userInput">cmd</span>, and then click <strong class="uiterm">OK</strong>.</td></tr><tr><td class="number">b. </td><td class="text">Type the following, and then press ENTER: <div class="indent"><span class="userInput">repadmin /options  -DISABLE_OUTBOUND_REPL</span></div></td></tr></table></td></tr><tr><td class="number">8.</td><td class="text">Verify that the <b>adprep /forestprep</b> changes have replicated on all the domain controllers in the forest. It is useful to monitor the following attributes:  <table class="list"><tr><td class="number">a. </td><td class="text">Incrementing the schema version</td></tr><tr><td class="number">b. </td><td class="text">The CN=Windows2003Update, CN=ForestUpdates,CN=Configuration,DC=<var>forest_root_domain</var> or CN=Operations,CN=DomainUpdates,CN=System,DC=<var>forest_root_domain</var> and the operations GUIDs under it have replicated in.</td></tr><tr><td class="number">c. </td><td class="text">Search for new schema classes, objects, attributes, or other changes that <b>adprep /forestprep</b> adds, such as inetOrgPerson. View the Sch<var>XX</var>.ldf files (where <var>XX</var> is a number between 14 and 30) in the
%systemroot%\System32 folder to determine what objects and attributes there should be. For example, inetOrgPerson is defined in Sch18.ldf.</td></tr></table></td></tr><tr><td class="number">9.</td><td class="text">Look for mangled LDAPDisplayNames.<br><br> If Exchange 2000 was installed before you ran the Windows Server 2003 <b>adprep /forestprep</b> command, see the "How to Identify Mangled Name Attributes" section of the following article in the Microsoft Knowledge Base:<div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/314649/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/314649/'" tppabs="http://support.microsoft.com/kb/314649/">314649</a></span> Windows Server 2003 adprep /forestprep command causes mangled attributes in Windows 2000 forests that contain Exchange 2000 servers

</div>If you find mangled names, go to Scenario 3 of the "Exchange 2000 in Windows 2000 Forests" section of the same article.</td></tr><tr><td class="number">10.</td><td class="text">Log on to the console of the schema operations master with an account that is a member of the Schema Admins group security group of the forest that hosts the schema operations master.</td></tr></table><a id="XSLTH4247120122120121120120"></a><h4>Upgrading the domain with the adprep /domainprep command</h4>Run <b>adprep /domainprep</b> after the <b>/forestprep</b> changes fully replicate to the infrastructure master domain controller in each domain that will host Windows Server 2003 domain controllers. To do so, follow these steps:  <table class="list"><tr><td class="number">1.</td><td class="text">Identify the infrastructure master domain controller in the domain you are upgrading, and then log on with an account that is a member of the Domain Admins security group in the domain you are upgrading.<br><br><b>Note</b>: The enterprise administrator may not be a member of the Domain Admins security group in child domains of the forest.</td></tr><tr><td class="number">2.</td><td class="text">Run <b>adprep /domainprep</b> on the Infrastructure master. To do so, click Start, click Run, type <span class="userInput">cmd</span>, and then on the Infrastructure master type the following command:<div class="indent"><span class="userInput">X:\I386\adprep /domainprep</span></div> where X:\I386\ is the path of the Windows Server 2003 installation media. This command runs domain-wide changes in the target domain.<br><br><b>Note</b>: The <b>adprep /domainprep</b> command modifies files permissions in the Sysvol share. These modifications cause a full synchronization of files in that directory tree.</td></tr><tr><td class="number">3.</td><td class="text">Verify that <b>domainprep</b> completed successfully. To do so, verify the following items:  <table class="list"><tr><td class="bullet">•</td><td class="text">The <b>adprep /domainprep</b> command completed without error.</td></tr><tr><td class="bullet">•</td><td class="text">The CN=Windows2003Update,CN=DomainUpdates,CN=System,DC=<var>dn path of domain you are upgrading</var> exists</td></tr></table> If <b>adprep /domainprep</b> does not run, verify the following items:  <table class="list"><tr><td class="bullet">•</td><td class="text">The logged on user who runs <b>adprep</b> has membership to the Domain Admins security group in the domain being you are upgrading. To do so, use the <b>whoami /all</b> command.</td></tr><tr><td class="bullet">•</td><td class="text">The fully qualified path for Adprep.exe located in the \I386 directory of the installation media was specified when you ran <b>adprep</b>. To do so, at a command prompt type the following command:<div class="indent"><span class="userInput"><var>x</var>:\i386\adprep /forestprep</span></div> where <var>x</var> is the drive that hosts the installation media.</td></tr><tr><td class="bullet">•</td><td class="text">If <b>adprep</b> still does not work, view the Adprep.log file in the %systemroot%\System32\Debug\Adprep\Logs\<var>Latest_log</var> folder.</td></tr></table></td></tr><tr><td class="number">4.</td><td class="text">Verify that the <b>adprep /domainprep</b> changes have replicated. To do so, for the remaining domain controllers in the domain, verify the following items:  <table class="list"><tr><td class="bullet">•</td><td class="text">The CN=Windows2003Update,CN=DomainUpdates,CN=System,DC=<var>dn path of domain you are upgrading</var> object exists and the value for the Revision attribute matches the value of the same attribute on the infrastructure master of the domain.</td></tr><tr><td class="bullet">•</td><td class="text">(Optional) Look for objects, attributes or access control list (ACL) changes that <b>adprep /domainprep</b> added.</td></tr></table>Repeat steps 1-4 on the infrastructure master of the remaining domains in bulk or as you add or upgrade DC's in those domains to Windows Server 2003. Now you can promote new Windows Server 2003 computers into the forest by using DCPROMO. Or, you can upgrade existing Windows 2000 domain controllers to Windows Server 2003 by using WINNT32.EXE.</td></tr></table><div class="topOfPage"><table><tr><td class="image"><a href="#toc"><img src="upArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/public/en-us/upArrow.gif" alt="Back to the top" title="Back to the top"></a></td><td class="text"><a href="#toc">Back to the top</a></td></tr></table></div></div><div class="sbody"><a id="XSLTH3120120123120121120120"></a><h3><span><a id="3"></a></span>Upgrading Windows 2000 domain controllers by using Winnt32.exe</h3>After the changes from <b>/forestprep</b> and <b>/domainprep</b> completely replicate and you have made a decision about security interoperability with earlier-version clients, you can upgrade Windows 2000 domain controllers to Windows Server 2003 and add new Windows Server 2003 domain controllers to the domain. <br><br>The following computers must be among the first domain controllers that run Windows Server 2003 in the forest in each domain:  <table class="list"><tr><td class="bullet">•</td><td class="text">The domain naming master in the forest so that you can create default DNS program partitions.</td></tr><tr><td class="bullet">•</td><td class="text">The primary domain controller of the forest root domain so that the enterprise-wide security principals that Windows Server 2003's <b>forestprep</b> adds become visible in the ACL editor.</td></tr><tr><td class="bullet">•</td><td class="text">The primary domain controller in each non-root domain so that you can create new domain-specific Windows 2003 security principals.</td></tr></table>To do so, use WINNT32 to upgrade existing domain controllers that host the operational role you want. Or, transfer the role to a newly-promoted Windows Server 2003 domain controller. Perform the following steps for each Windows 2000 domain controller that you upgrade to Windows Server 2003 with WINNT32 and for each Windows Server 2003 workgroup or member computer that you promote:  <table class="list"><tr><td class="number">1.</td><td class="text">Before you use WINNT32 to upgrade Windows 2000 member computers and domain controllers, remove Windows 2000 Administration Tools. To do so, use the Add/Remove Programs tool in Control Panel. (Windows 2000 upgrades only.)</td></tr><tr><td class="number">2.</td><td class="text">Install any hotfix files or other fixes that either Microsoft or the administrator determines is important.</td></tr><tr><td class="number">3.</td><td class="text">Check each domain controller for possible upgrade issues. To do so, run the following command from the \I386 folder of the installation media: <div class="indent"><span class="userInput">winnt32.exe /checkupgradeonly</span></div>Resolve any issues that the compatibility check identifies.</td></tr><tr><td class="number">4.</td><td class="text">Run WINNT32.EXE from the \I386 folder of the installation media, and the restart the upgraded 2003 domain controller.</td></tr><tr><td class="number">5.</td><td class="text">Lower the security settings for earlier-version clients as required.<br><br>If Windows NT 4.0 clients do not have NT 4.0 SP6 or Windows 95 clients do not have the directory service client installed, disable SMB Service signing on the Default Domain Controllers policy on the Domain Controllers organizational unit, and then link this policy to all organizational units that host domain controllers.<div class="indent">
Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options\Microsoft Network Server: Digitally sign communications (always)
</div></td></tr><tr><td class="number">6.</td><td class="text">Verify the health of the upgrade using the following data points:  <table class="list"><tr><td class="bullet">•</td><td class="text">The upgrade completed successfully.</td></tr><tr><td class="bullet">•</td><td class="text">The hotfixes that you added to the installation successfully replaced the original binaries.</td></tr><tr><td class="bullet">•</td><td class="text">Inbound and outbound replication of Active Directory is occurring for all naming contexts held by the domain controller.</td></tr><tr><td class="bullet">•</td><td class="text">The Netlogon and Sysvol shares exist.</td></tr><tr><td class="bullet">•</td><td class="text">The event log indicates that the domain controller and its services are healthy.<br><br><b>Note</b>: You may receive the following event message after you upgrade:<div class="indent"><p class="indent">Event Type: Error <br>Event Source: NTDS Backup <br>Event Category: Backup <br>Event ID: 1913 <br>Date: <var>Date</var><br>Time: HH:MM:SSAM|PM <br>User: N/A <br>Computer: <var>computername</var><br>Description: Internal error: The Active Directory backup and restore operation encountered an unexpected error. Backup or restore will not succeed until this is corrected. </p></div>You can safely ignore this event message.</td></tr></table></td></tr><tr><td class="number">7.</td><td class="text">Install the Windows Server 2003 Administration Tools (Windows 2000 upgrades and Windows Server 2003 non-domain controllers only). Adminpak.msi is in the \I386 folder of the Windows Server 2003 CD-ROM. Windows Server 2003 media contains updated support tools in the Support\Tools\Suptools.msi file. Make sure that you reinstall this file.</td></tr><tr><td class="number">8.</td><td class="text">Make new backups of at least the first two Windows 2000 domain controllers that you upgraded to Windows Server 2003 in each domain in the forest. Locate the backups of the Windows 2000 computers that you upgraded to Windows Server 2003 in locked storage so you do not accidentally use them to restore a domain controller that now runs Windows Server 2003.</td></tr><tr><td class="number">9.</td><td class="text">(Optional) Perform an offline defragmentation of the Active Directory database on the domain controllers that you upgraded to Windows Server 2003 after the single instance store (SIS) has completed (Windows 2000 upgrades only).<br><br>The SIS reviews existing permissions on objects stored in Active Directory, and then applies a more efficient security descriptor on those objects. The SIS starts automatically (identified by event 1953 in the directory service event log) when upgraded domain controllers first start the Windows Server 2003 operating system. You benefit from the improved security descriptor store only when you log an event ID 1966 event message in the directory service event log: <p class="indent">Event Type: Information <br>Event Source: NTDS SDPROP <br>Event Category: Internal Processing<br>Event ID: 1966 <br>Date: MM/DD/YYYY<br>Time: HH:MM:SS AM|PM <br>User: NT AUTHORITY\ANONYMOUS LOGON <br>Computer: &lt;computername&gt;<br>Description: The security descriptor propagator has completed a full propagation pass. <br>Allocated space (MB): <br>XX Free space (MB): XX <br><br>This may have increased free space in the Active Directory database. <br>User Action: Consider defragmenting the database offline to reclaim the free space that may be available in the Active Directory database. For more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp. </p>This event message indicates that the single instance store operation has completed and serves as a queues the administrator to perform of offline defragmentation of the Ntds.dit using NTDSUTIL.EXE. <br><br>The offline defragmentation can reduce the size of a Windows 2000 Ntds.dit file by up to 40%, improves Active Directory performance, and updates the pages in the database for more efficient storage of Link Valued attributes.

For additional information about how to defragment the Active Directory   database, click the following article number to view the article in the Microsoft Knowledge Base:

<div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/232122/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/232122/'" tppabs="http://support.microsoft.com/kb/232122/">232122</a></span>

 Performing offline defragmentation of the Active Directory database

</div></td></tr><tr><td class="number">10.</td><td class="text">Investigate the DLT Server Service. Windows Server 2003 domain controllers disable the DLT Server service on fresh and upgrade installs. If Windows 2000 or Windows XP clients in your organization use the DLT Server service, use Group Policy to enable the DLT Server service on new or upgraded Windows Server 2003 domain controllers. Otherwise, incrementally delete distributed link tracking objects from Active Directory.

For additional information, click the following article numbers to view the articles in the Microsoft Knowledge Base:

<div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/312403/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/312403/'" tppabs="http://support.microsoft.com/kb/312403/">312403</a></span>

 Distributed link tracking on Windows-based domain controllers

</div><div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/315229/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/315229/'" tppabs="http://support.microsoft.com/kb/315229/">315229</a></span> Text version of Dltpurge.vbs for Microsoft Knowledge Base article Q312403

</div>If you bulk delete thousands of DLT objects or other objects, you may block replication because of a lack of version store. Wait <var>tombstonelifetime</var> number of days (by default, 60 days) after you delete the last DLT object and for garbage collection to complete, then use NTDSUTIL.EXE to perform an offline defragmentation of the Ntds.dit file.</td></tr><tr><td class="number">11.</td><td class="text">Configure the best practice organizational unit structure. Microsoft recommends that administrators actively deploy the best practice organizational unit structure in all the Active Directory domains, and after they upgrade or deploy Windows Server 2003 domain controllers in Windows Domain mode, redirect the default containers that earlier-version APIs use to create users, computers and groups to an organizational unit container that the administrator specifies.<br><br>For additional information about the best practice organizational unit structure, view the "Creating an Organizational Unit Design" section of the "Best Practice Active Directory Design for Managing Windows Networks" white paper. To view the white paper, visit the following Microsoft Web site: <div class="indent"><span><a href="javascript:if(confirm('http://www.microsoft.com/technet/prodtechnol/windows2000serv/technologies/activedirectory/plan/bpaddsgn.mspx  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.microsoft.com/technet/prodtechnol/windows2000serv/technologies/activedirectory/plan/bpaddsgn.mspx'" tppabs="http://www.microsoft.com/technet/prodtechnol/windows2000serv/technologies/activedirectory/plan/bpaddsgn.mspx">http://www.microsoft.com/technet/prodtechnol/windows2000serv/technologies/activedirectory/plan/bpaddsgn.mspx</a></span></div>

For additional information about changing the default container where users, computers and groups   that earlier-version APIs create are located, click the following article number to view the article in the Microsoft Knowledge Base:

<div class="indent"><span><a class="KBlink" href="javascript:if(confirm('http://support.microsoft.com/kb/324949/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/kb/324949/'" tppabs="http://support.microsoft.com/kb/324949/">324949</a></span>

 Redirecting the Users and Computers containers in Windows Server 2003   Domains

</div></td></tr><tr><td class="number">12.</td><td class="text">Repeat steps 1 through 10 as required for each new or upgraded Windows Server 2003 domain controller in the forest and step 11 (Best Practice organizational unit structure) for each Active Directory domain.<br><br> In Summary:  <table class="list"><tr><td class="bullet">•</td><td class="text">Upgrade Windows 2000 Domain controllers with WINNT32 (from the slipstreamed installation media if used)</td></tr><tr><td class="bullet">•</td><td class="text">Verify the hotfixed files have been installed on the upgraded computers</td></tr><tr><td class="bullet">•</td><td class="text">Install any required hotfixes not contained on installation media</td></tr><tr><td class="bullet">•</td><td class="text">Verify the health on new or upgraded servers ( AD, FRS, Policy etc)</td></tr><tr><td class="bullet">•</td><td class="text">Wait 24 hours after OS upgrade then offline defrag (optional)</td></tr><tr><td class="bullet">•</td><td class="text">Start the DLT Service if you must, otherwise delete DLT objects using q312403 / q315229 post forest wide domainpreps</td></tr><tr><td class="bullet">•</td><td class="text">Perform offline defrag 60+ days (tombstone lifetime and garbage collection # of days) after deleting DLT objects</td></tr></table></td></tr></table><a id="XSLTH3132120123120121120120"></a><h3>Dry-run upgrades in a lab environment</h3>Before you upgrade Windows domain controllers to a production Windows 2000 domain, validate and refine your upgrade process in the lab. If the upgrade of a lab environment that accurately mirrors the production forest performs smoothly, you can expect similar results in production environments. For complex
environments, the lab environment must mirror the production environment in the following areas:  <table class="list"><tr><td class="bullet">•</td><td class="text"><b>Hardware</b>: computer type, memory size, page file placement, disk size, performance and raid configuration, BIOS and firmware revision levels</td></tr><tr><td class="bullet">•</td><td class="text"><b>Software</b>: client and server operating system versions, client and server applications, service pack versions, hotfixes, schema changes, security groups, group memberships, permissions, policy settings, object count type and location, version interoperability</td></tr><tr><td class="bullet">•</td><td class="text"><b>Network infrastructure</b>: WINS, DHCP, link speeds, available bandwidth</td></tr><tr><td class="bullet">•</td><td class="text"><b>Load</b>: Load simulators can simulate password changes, object creation, Active Directory replication, logon authentication and other events. The goal is not to reproduce the scale of the production environment. Instead, the goals are to discover the costs and frequency of common operations and to interpolate their effects (name queries, replication traffic, network bandwidth, and processor consumption) on the production environment based on your current and future requirements.</td></tr><tr><td class="bullet">•</td><td class="text"><b>Administration</b>: tasks performed, tools used, operating systems used </td></tr><tr><td class="bullet">•</td><td class="text"><b>Operation</b>: capacity, interoperability</td></tr><tr><td class="bullet">•</td><td class="text"><b>Disk Space</b>: Note the starting, peak and ending size of the operating system, Ntds.dit and Active Directory log files on global catalog and non-global catalog domain controllers in each domain after each of the following operations:  <table class="list"><tr><td class="number">a. </td><td class="text"><b>adprep /forestprep</b></td></tr><tr><td class="number">b. </td><td class="text"><b>adprep /domainprep</b></td></tr><tr><td class="number">c. </td><td class="text">Upgrading Windows 2000 domain controllers to Windows Server 2003 </td></tr><tr><td class="number">d. </td><td class="text">Performing offline defragmentation after version upgrades</td></tr></table></td></tr></table> An understanding of the upgrade process and complexity of the environment combined with detailed observation determines the pace and degree of care that you apply to upgrading production environments. Environments with a small number of domain controllers and Active Directory objects connected over high availability wide area network (WAN) links might upgrade in only a few hours. You may have to take more care with enterprise deployments that have hundreds of domain controllers or hundreds of thousands of Active Directory objects. In such cases, you may want to perform the upgrade over the course of several weeks or months. <br><br> Use "Dry-run" upgrades in the lab to perform the following tasks:  <table class="list"><tr><td class="bullet">•</td><td class="text">Understand the inner workings of the upgrade process and the associated risks.</td></tr><tr><td class="bullet">•</td><td class="text">Expose potential problem areas for the deployment process in your environment.</td></tr><tr><td class="bullet">•</td><td class="text">Test and develop fall-back plans in case the upgrade does not succeed.</td></tr><tr><td class="bullet">•</td><td class="text">Define the appropriate level of detail to apply to the upgrade process for the production domain.</td></tr></table><a id="XSLTH3140120123120121120120"></a><h3>Domain controllers without sufficient disk space</h3>On domain controllers with insufficient disk space, use the following steps to free up additional disk space on the volume that hosts the Ntds.dit and Log files:  <table class="list"><tr><td class="number">a. </td><td class="text">Delete the unused files including *.tmp files or cached files that internet browsers use. To do so, type the following commands (press ENTER after each command):<div class="indent"><span class="userInput">cd /d <var>drive</var>\</span><br><span class="userInput">del *.tmp /s</span></div></td></tr><tr><td class="number">b. </td><td class="text">Delete any user or memory dump files. To do so, type the following commands (press ENTER after each command):<div class="indent"><span class="userInput">cd /d <var>drive</var>\</span><br><span class="userInput">del *.dmp /s</span></div></td></tr><tr><td class="number">c. </td><td class="text">Temporarily remove or relocate files that you can access from other servers or easily reinstall. Files that you can remove and easily replace include ADMINPAK, Support Tools, and all the files in the %systemroot%\System32\Dllcache folder.</td></tr><tr><td class="number">d. </td><td class="text">Delete old or unused user profiles. To do so, click <strong class="uiterm">Start</strong>, right-click <strong class="uiterm">My Computer</strong>, click <strong class="uiterm">Properties</strong>, click the <strong class="uiterm">User Profiles</strong> tab, and then delete all the profiles that are for old and unused accounts. Do not delete any profiles that may be for service accounts.</td></tr><tr><td class="number">e. </td><td class="text">Delete the symbols at %systemroot%\Symbols. To do so, type the following command:<div class="indent"><span class="userInput">rd /s %systemroot%\symbols</span></div>Depending on whether the servers have a full or small symbol set, this may gain approximately 70 MB to 600 MB. </td></tr><tr><td class="number">f. </td><td class="text">Perform an offline defragmentation. An offline defragmentation of the Ntds.dit file may free up space but temporarily requires double the space of the current DIT file. Perform the offline defrag by using other local volumes if one is available. Or, use space on a best connected network server to perform the offline defragmentation. If the disk space is still not sufficient, incrementally delete unnecessary user accounts, computer accounts, DNS records and DLT objects from Active Directory.<br><br><b>Note</b>: Active Directory does not delete objects from the database until <var>tombstonelifetime</var> number of days (by default, 60 days) have passed and the garbage collection completes. If you reduce <var>tombstonelifetime</var> to a value lower than end-to-end replication in the forest, you may cause inconsistencies in Active Directory.</td></tr></table><div class="topOfPage"><table><tr><td class="image"><a href="#toc"><img src="upArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/public/en-us/upArrow.gif" alt="Back to the top" title="Back to the top"></a></td><td class="text"><a href="#toc">Back to the top</a></td></tr></table></div></div></div><div class="appliesTo"><hr><a id="appliesto"></a><h5>APPLIES TO</h5><table class="list"><tr><td class="bullet">•</td><td class="text">Microsoft Windows Server 2003, Standard Edition</td></tr><tr><td class="bullet">•</td><td class="text">Microsoft Windows Server 2003, Enterprise Edition</td></tr><tr><td class="bullet">•</td><td class="text">Microsoft Windows Server 2003, Datacenter Edition</td></tr><tr><td class="bullet">•</td><td class="text">Microsoft Windows 2000 Server</td></tr><tr><td class="bullet">•</td><td class="text">Microsoft Windows 2000 Advanced Server</td></tr><tr><td class="bullet">•</td><td class="text">Microsoft Windows 2000 Datacenter Server</td></tr><tr><td class="bullet">•</td><td class="text">Microsoft Exchange 2000 Server Standard Edition</td></tr></table></div><div class="topOfPage"><table><tr><td class="image"><a href="#toc"><img src="upArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/public/en-us/upArrow.gif" alt="Back to the top" title="Back to the top"></a></td><td class="text"><a href="#toc">Back to the top</a></td></tr></table></div><div class="keywords"><table cellspacing="1"><tr><td class="header"><h5>Keywords: </h5></td><td class="text">kbinfo KB325379 </td></tr></table><div class="topOfPage"><table><tr><td class="image"><a href="#toc"><img src="upArrow.gif" tppabs="http://support.microsoft.com/library/images/support/kbgraphics/public/en-us/upArrow.gif" alt="Back to the top" title="Back to the top"></a></td><td class="text"><a href="#toc">Back to the top</a></td></tr></table></div></div><div class="disclaimer"><div class="text"></div></div><!-- - -KB 3 end- - --></div></div></div></td><td class="primaryThinColumn"><div id="thinColumn" style="float: none;"><div class="wp articleTrans"><h1>Article Translations</h1><form name="frmArticleTrans" action="http://support.microsoft.com/" onsubmit="return SwitchLanguage();"><div><table cellpadding="0" cellspacing="0"><tr><td><select name="scid"><option value="kb;pt-br;325379">Brazilian</option><option value="kb;cs;325379">Czech</option><option value="kb;nl;325379">Dutch</option><option value="kb;fr;325379">French</option><option value="kb;de;325379">German</option><option value="kb;el;325379">Greek</option><option value="kb;hu;325379">Hungarian</option><option value="kb;it;325379">Italian</option><option value="kb;ja;325379">Japanese</option><option value="kb;ko;325379">Korean</option><option value="kb;pl;325379">Polish</option><option value="kb;ru;325379">Russian</option><option value="kb;zh-cn;325379">Simplified Chinese</option><option value="kb;es;325379">Spanish</option><option value="kb;zh-tw;325379">Traditional Chinese</option><option value="kb;tr;325379">Turkish</option></select></td><td class="spacer">&nbsp;</td><td><input type="image" alt="Translate the article" width="24" height="24" onmouseover="this.src='go_right_02-over.gif'/*tpa=http://support.microsoft.com/library/images/support/EN-US/go_right_02-over.gif*/;" onmouseout="this.src='GSSSM_rltlngRelatedlanguages.gif'/*tpa=http://support.microsoft.com/library/images/support/en-US/GSSSM_rltlngRelatedlanguages.gif*/;" src="GSSSM_rltlngRelatedlanguages.gif" tppabs="http://support.microsoft.com/library/images/support/en-US/GSSSM_rltlngRelatedlanguages.gif"><a id="KBLangListRedirect" href="" /></td></tr></table></div></form></div><div class="wp" id="RelatedSupportCenters"><table cellpadding="0" cellspacing="0"><tr><td class="textColumn"><h1>Related Support Centers</h1><table class="list" cellpadding="2" cellspacing="0"><tr class="er"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="bullet">&#149;</td><td class="text"><a href="-scid=ph;en-us;1131.htm" tppabs="http://support.microsoft.com/?scid=ph;en-us;1131" onclick="return MS_HandleClick(this,'29800', true);">Microsoft Windows 2000</a></td></tr></table></td></tr><tr class="or"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="bullet">&#149;</td><td class="text"><a href="-scid=ph;en-us;1760.htm" tppabs="http://support.microsoft.com/?scid=ph;en-us;1760" onclick="return MS_HandleClick(this,'29800', true);">Microsoft Exchange 2000 Server</a></td></tr></table></td></tr><tr class="er"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="bullet">&#149;</td><td class="text"><a href="-scid=ph;en-us;3198.htm" tppabs="http://support.microsoft.com/?scid=ph;en-us;3198" onclick="return MS_HandleClick(this,'29800', true);">Microsoft Windows Server 2003</a></td></tr></table></td></tr></table></td></tr></table></div><div class="wp" id="AdditionalResources"><table cellpadding="0" cellspacing="0"><tr><td class="textColumn"><h1>Other Support Options</h1><table class="list" cellpadding="2" cellspacing="0"><tr class="er" id="L_85573_tr"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="bullet">&#149;</td><td class="text"><a href="javascript:if(confirm('http://support.microsoft.com/contactus/?ws=support  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/contactus/?ws=support'" tppabs="http://support.microsoft.com/contactus/?ws=support" id="L_85573" title="Contact Microsoft" onclick="return MS_HandleClick(this,'29797', true);">Contact Microsoft</a><br>Phone Numbers, Support Options and Pricing, Online Help, and more.</td></tr></table></td></tr><tr class="or" id="L_85574_tr"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="bullet">&#149;</td><td class="text"><a href="javascript:if(confirm('http://support.microsoft.com/?scid=gp;[ln];csshome&style=home  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/?scid=gp;[ln];csshome&style=home'" tppabs="http://support.microsoft.com/?scid=gp;[ln];csshome&style=home" id="L_85574" title="Customer Service" onclick="return MS_HandleClick(this,'29797', true);">Customer Service</a><br>For non-technical assistance with product purchases, subscriptions, online services, events, training courses, corporate sales, piracy issues, and more.</td></tr></table></td></tr><tr class="er" id="L_85575_tr"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="bullet">&#149;</td><td class="text"><a href="javascript:if(confirm('http://support.microsoft.com/newsgroups/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/newsgroups/'" tppabs="http://support.microsoft.com/newsgroups/" id="L_85575" title="Newsgroups" onclick="return MS_HandleClick(this,'29797', true);">Newsgroups</a><br>Pose a question to other users. Discussion groups and Forums about specific Microsoft products, technologies, and services.</td></tr></table></td></tr></table></td></tr></table></div><div class="wp" id="SupportTools"><table cellpadding="0" cellspacing="0"><tr><td class="textColumn"><h1>Page Tools</h1><table class="list" cellpadding="2" cellspacing="0"><tr class="er" id="PrintPage_tr"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="image"><a href="javascript:if(confirm('http://support.microsoft.com/gp/noscript/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/gp/noscript/'" tppabs="http://support.microsoft.com/gp/noscript/" id="PrintPage_i" title="Print this page" onclick="return MS_HandleClick(this,'SupportTools', true);"><img alt="Print this page" id="bi_PrintPage" src="printicon.gif" tppabs="http://support.microsoft.com/library/images/support/cn/printicon.gif"></a></td><td class="text"><a href="javascript:if(confirm('http://support.microsoft.com/gp/noscript/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/gp/noscript/'" tppabs="http://support.microsoft.com/gp/noscript/" id="PrintPage" title="Print this page" onclick="return MS_HandleClick(this,'SupportTools', true);">Print this page</a></td></tr></table></td></tr><tr class="or" id="EmailPage_tr"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="image"><a href="mailto:?subject=How%20to%20upgrade%20Windows%202000%20domain%20controllers%20to%20Windows%20Server%202003&amp;body=http%3a%2f%2fsupport.microsoft.com%2fdefault.aspx%2fkb%2f325379" id="EmailPage_i" title="E-mail this page" onclick="return MS_HandleClick(this,'SupportTools', true);"><img alt="E-mail this page" id="bi_EmailPage" src="emailicon.gif" tppabs="http://support.microsoft.com/library/images/support/cn/emailicon.gif"></a></td><td class="text"><a href="mailto:?subject=How%20to%20upgrade%20Windows%202000%20domain%20controllers%20to%20Windows%20Server%202003&amp;body=http%3a%2f%2fsupport.microsoft.com%2fdefault.aspx%2fkb%2f325379" id="EmailPage" title="E-mail this page" onclick="return MS_HandleClick(this,'SupportTools', true);">E-mail this page</a></td></tr></table></td></tr><tr class="er" id="Worldwide_tr"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="image"><a href="javascript:if(confirm('http://support.microsoft.com/common/international.aspx?rdPath=0  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/common/international.aspx?rdPath=0'" tppabs="http://support.microsoft.com/common/international.aspx?rdPath=0" id="Worldwide_i" title="Microsoft Worldwide" onclick="return MS_HandleClick(this,'SupportTools', true);"><img alt="Microsoft Worldwide" id="bi_Worldwide" src="langicon.gif" tppabs="http://support.microsoft.com/library/images/support/cn/langicon.gif"></a></td><td class="text"><a href="javascript:if(confirm('http://support.microsoft.com/common/international.aspx?rdPath=0  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/common/international.aspx?rdPath=0'" tppabs="http://support.microsoft.com/common/international.aspx?rdPath=0" id="Worldwide" title="Microsoft Worldwide" onclick="return MS_HandleClick(this,'SupportTools', true);">Microsoft Worldwide</a></td></tr></table></td></tr><tr class="or" id="SaveToMySupportFavorites_tr"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="image"><a href="javascript:if(confirm('http://support.microsoft.com/gp/noscript/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/gp/noscript/'" tppabs="http://support.microsoft.com/gp/noscript/" id="SaveToMySupportFavorites_i" title="Save to My Support Favorites" onclick="return MS_HandleClick(this,'SupportTools', true);"><img alt="Save to My Support Favorites" id="bi_SaveToMySupportFavorites" src="saveicon.gif" tppabs="http://support.microsoft.com/library/images/support/cn/saveicon.gif"></a></td><td class="text"><a href="javascript:if(confirm('http://support.microsoft.com/gp/noscript/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/gp/noscript/'" tppabs="http://support.microsoft.com/gp/noscript/" id="SaveToMySupportFavorites" title="Save to My Support Favorites" onclick="return MS_HandleClick(this,'SupportTools', true);">Save to My Support Favorites</a></td></tr></table></td></tr><tr class="er" id="MySupportFavoritesLink_tr"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="image"><a href="javascript:if(confirm('http://support.microsoft.com/gp/noscript/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/gp/noscript/'" tppabs="http://support.microsoft.com/gp/noscript/" id="MySupportFavoritesLink_i" title="Go to My Support Favorites" onclick="return MS_HandleClick(this,'SupportTools', true);"><img alt="Go to My Support Favorites" id="bi_MySupportFavoritesLink" src="gotoicon.gif" tppabs="http://support.microsoft.com/library/images/support/cn/gotoicon.gif"></a></td><td class="text"><a href="javascript:if(confirm('http://support.microsoft.com/gp/noscript/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/gp/noscript/'" tppabs="http://support.microsoft.com/gp/noscript/" id="MySupportFavoritesLink" title="Go to My Support Favorites" onclick="return MS_HandleClick(this,'SupportTools', true);">Go to My Support Favorites</a></td></tr></table></td></tr><tr class="or" id="SendFeedback_tr"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="image"><a href="javascript:if(confirm('http://support.microsoft.com/gp/noscript/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/gp/noscript/'" tppabs="http://support.microsoft.com/gp/noscript/" id="SendFeedback_i" target="_blank" title="Send Feedback" onclick="return MS_HandleClick(this,'SupportTools', true);"><img alt="Send Feedback" id="bi_SendFeedback" src="sendicon.gif" tppabs="http://support.microsoft.com/library/images/support/cn/sendicon.gif"></a></td><td class="text"><a href="javascript:if(confirm('http://support.microsoft.com/gp/noscript/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/gp/noscript/'" tppabs="http://support.microsoft.com/gp/noscript/" id="SendFeedback" target="_blank" title="Send Feedback" onclick="return MS_HandleClick(this,'SupportTools', true);">Send Feedback</a></td></tr></table></td></tr><tr class="er"><td class="lc0"><table class="innerTable" cellpadding="0" cellspacing="0"><tr><td class="text"><div class="center"><a href="javascript:if(confirm('https://profile.microsoft.com/RegSysProfileCenter/wizard.aspx?wizid=6182013c-7c1f-40a3-99ae-27651c3668aa&lcid=1033&fu=%2fdefault.aspx%2fkb%2f325379&brand=Microsoft  \n\nThis file was not retrieved by Teleport Pro, because it is addressed using an unsupported protocol (e.g., gopher).  \n\nDo you want to open it from the server?'))window.location='https://profile.microsoft.com/RegSysProfileCenter/wizard.aspx?wizid=6182013c-7c1f-40a3-99ae-27651c3668aa&lcid=1033&fu=%2fdefault.aspx%2fkb%2f325379&brand=Microsoft'" tppabs="https://profile.microsoft.com/RegSysProfileCenter/wizard.aspx?wizid=6182013c-7c1f-40a3-99ae-27651c3668aa&lcid=1033&fu=%2fdefault.aspx%2fkb%2f325379&brand=Microsoft"><IMG SRC="signin.gif" tppabs="http://www.passportimages.com/1033/signin.gif" CLASS="PassportSignIn" BORDER="0" ALT="Sign in to the Microsoft Passport Network" ID="idSI"/></A></div></td></tr></table></td></tr></table></td></tr></table></div></div></td></tr></table></div></div><div id="widthFix"></div></div></XMLREADER></td></tr></table><br clear="all" style="line-height: 1px; overflow: hidden"><table id="msviFooter" width="100%" cellpadding="0" cellspacing="0"><tr valign="bottom"><td id="msviFooter2" style="filter:progid:DXImageTransform.Microsoft.Gradient(startColorStr='#FFFFFF', endColorStr='#3F8CDA', gradientType='1')"><div id="msviLocalFooter"><nobr><a href="javascript:if(confirm('http://go.microsoft.com/?linkid=317027  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://go.microsoft.com/?linkid=317027'" tppabs="http://go.microsoft.com/?linkid=317027">Manage Your Profile</a> |</nobr><wbr><nobr><a href="javascript:if(confirm('http://support.microsoft.com/contactus/?ws=support  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/contactus/?ws=support'" tppabs="http://support.microsoft.com/contactus/?ws=support" target="_parent">Contact Us</a></nobr></div><div id="msviGlobalFooter"><span dir="ltr">&#169;2005 Microsoft Corporation. All rights reserved.&nbsp;</span><nobr><a href="javascript:if(confirm('http://support.microsoft.com/tou/  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/tou/'" tppabs="http://support.microsoft.com/tou/">Terms of Use</a> |</nobr><wbr><nobr><a href="javascript:if(confirm('http://support.microsoft.com/library/toolbar/3.0/trademarks/en-us.mspx  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://support.microsoft.com/library/toolbar/3.0/trademarks/en-us.mspx'" tppabs="http://support.microsoft.com/library/toolbar/3.0/trademarks/en-us.mspx">Trademarks</a> |</nobr><wbr><nobr><a href="index-2.htm" tppabs="http://support.microsoft.com/privacy/">Privacy Statement</a></nobr></div></td></tr></table><img id="webmetriximg" alt="" src="onepix.gif" tppabs="http://support.microsoft.com/library/images/support/cn/onepix.gif"><noscript><img id="StatsDotNetImgNoScript" alt="" src="default.aspx-SSID=1&#38;SiteLCID=1033&#38;EventCollectionID=1&#38;URL=%2fdefault.aspx&#38;ContentType=kb&#38;ContentLCID=1033&#38;ContentID=325379&#38;BrandID=1&#38;" tppabs="http://support.microsoft.com/LTS/default.aspx?SSID=1&#38;SiteLCID=1033&#38;EventCollectionID=1&#38;URL=%2fdefault.aspx&#38;ContentType=kb&#38;ContentLCID=1033&#38;ContentID=325379&#38;BrandID=1&#38;"></noscript><img id="StatsDotNetImg" name="StatsDotNetImg" alt="" src="onepix.gif" tppabs="http://support.microsoft.com/library/images/support/cn/onepix.gif" /><script type="text/javascript">StatsDotNet.disabled=false;StatsDotNet.host='http://support.microsoft.com/error.aspx?404;/kb/http/x3a/x2f/x2fsupport.microsoft.com/x2fLTS/x2fdefault.aspx';StatsDotNet.ssId='1';StatsDotNet.siteLcId='1033';StatsDotNet.url='http://support.microsoft.com/x2fdefault.aspx';StatsDotNet.contentType='kb';StatsDotNet.contentLn='1033';StatsDotNet.contentId='325379';StatsDotNet.eventCollectionId=1;StatsDotNet.siteBrandId='1';StatsDotNet.onUnloadTimeout=300;</script><script type="text/javascript">function thisLoad(){MS_WebMetrix('http://support.microsoft.com/kb/http/x3a/x2f/x2fc.microsoft.com/x2ftrans_pixel.asp/x3fTYPE/x3dSSPV/x26SOURCE/x3dSUPPORT/x26GUID/x3d1F4FC18C-F71E-47fb-8FC9-612F8EE59C61/x26URI/x3d/x252fgn/x252fen-us/x252fkb_en-us_325379/x26R/x3dhttp/x253a/x252f/x252fsupport.microsoft.com');StatsDotNet.LogPageOnLoad();g_reSupportedHostnames = new RegExp("\\.microsoft\\.com$|\\.passport\\.com$", "i");ForeignLink_Hookup(true);MNPResizeFix();}function thisUnload(){}</script></body></html>